/*! Fab.fm js 17-12-2015 */
window.FAB={Model:{},Collection:{},Util:{},Controller:{},Router:{},Vent:{},View:{Block:{},Element:{},Page:{}}},FAB.config={},FAB.Router=Backbone.Router.extend({routes:{"":"index",swipe:"swipe"},swipe:function(){FAB.Vent.trigger("swipe")},index:function(){console.log("index, hello")}}),FAB.Model.Track=Backbone.Model.extend({defaults:{publishedid:null,clip:null},initialize:function(){this.set("clip",new Audio([this.get("preview")]))}}),FAB.Collection.TrackList=Backbone.Collection.extend({model:FAB.Model.Track}),FAB.Controller=Backbone.View.extend({el:".page",initialize:function(){this.swipe=new FAB.View.Page.Swipe,console.log("main"),FAB.Vent.on("swipe",this.loadSwipe,this),this.render()},render:function(){return this},loadSwipe:function(){this.$el.html(this.swipe.render().el)}}),FAB.View.Element.Poster=Backbone.View.extend({className:"swipe-poster",initialize:function(a){this.vent=a.vent,this.listenTo(this.model,"remove",this.removeView)},render:function(){return this.el.style.backgroundImage="url("+this.model.get("art")+")",this},start:function(a){this.start={x:a.offsetX,y:a.offsetY}},listen:function(){var a=this.model.get("clip");a.play(),a.addEventListener("ended",function(){this.vent.trigger("trackOver"),a.currentTime=0}.bind(this)),this.vent.on("playPause",this.playPause,this),this.vent.on("realign",this.align,this),this.vent.on("move",this.move,this)},move:function(a){var b=a.x+this.position.x,c=a.y+this.position.y;this.el.style.transform="translateX("+b+"px) translateY("+c+"px) rotate("+a.x/10+"deg)"},playPause:function(){var a=this.model.get("clip");a.paused?a.play():a.pause()},align:function(){if(this.el.parentElement){var a=this.el.parentElement.clientHeight,b=this.el.parentElement.clientWidth,c=this.el.offsetHeight,d=this.el.offsetWidth,e=(a-c)/2,f=(b-d)/2;this.position={x:f,y:e},this.el.style.transform="translateX("+f+"px) translateY("+e+"px) rotate(0deg)"}},removeView:function(){this.vent.off("playPause"),this.model.get("clip").pause(),this.stopListening(),this.remove()}}),FAB.View.Element.SwipeController=Backbone.View.extend({className:"swipe-controller",events:{"touchstart #play-control":"playPause","click #play-control":"playPause",touchstart:"start",mousedown:"start",touchmove:"move",mousemove:"move",touchend:"stop",mouseup:"stop"},initialize:function(a){this.vent=a.vent,this.vent.on("trackOver",this.trackOver,this)},render:function(){return this.$el.append("<div id='play-control'></div>"),this},start:function(a){this.start={x:a.offsetX||Math.floor(a.originalEvent.touches[0].clientX),y:a.offsetY||Math.floor(a.originalEvent.touches[0].clientY)}},move:function(a){if(a.which||"mousemove"!==a.type){this.$("#play-control").css({color:"transparent"});var b=a.offsetX||Math.floor(a.originalEvent.touches[0].clientX),c=a.offsetY||Math.floor(a.originalEvent.touches[0].clientY),d=b-this.start.x,e=c-this.start.y;this.vent.trigger("move",{x:d,y:e})}},stop:function(a){var b=a.offsetX||Math.floor(a.originalEvent.changedTouches[0].clientX),c=b-this.start.x;c>200?this.vent.trigger("save"):-200>c?this.vent.trigger("pass"):this.vent.trigger("realign"),this.$("#play-control").css({color:"black"})},align:function(){var a=this.$("#play-control"),b=a.offset().left;this.$el.width();console.log("left",a.offsetLeft),this.$el.width("100%"),a.css({left:b,color:"black"})},playPause:function(a){a.preventDefault(),a.stopPropagation(),this.$("#play-control").toggleClass("paused"),this.vent.trigger("playPause")},trackOver:function(){this.$("#play-control").toggleClass("paused")}}),FAB.View.Block.Playlist=Backbone.View.extend({el:"#track-list",initialize:function(){this.listenTo(this.collection,"add",this.addTrack)},render:function(){return this},addTrack:function(a){var b=new TrackView({model:a});this.$el.append(b.render().el)}}),FAB.View.Page.Swipe=Backbone.View.extend({el:".page",tracks:[],initialize:function(){this.vent=_.extend({},Backbone.Events),this.collection=new FAB.Collection.TrackList,this.playList=new FAB.Collection.TrackList,this.collection.url="fabricMusicAPI.php",this.listenTo(this.playList,"add",this.addTrackToList,this),this.listenTo(this.collection,"reset",this.addTracks,this),this.vent.on({save:this.addToList,"pass save":this.next},this),FAB.Vent.on("swipe",this.bootstrap,this)},render:function(){this.$el.height(),this.$el.width();console.log("FAB",FAB.View);var a=new FAB.View.Element.SwipeController({vent:this.vent});new FAB.View.Block.Playlist({collection:this.playList});return this.$el.append(a.render().el),a.align(),this},bootstrap:function(a){console.log("hi"),this.collection.fetch({data:{artistInfo:a},reset:!0})},addTracks:function(){this.collection.slice(0,3).forEach(this.renderTrack,this),this.tracks[0].listen()},renderTrack:function(a){var b=new FAB.View.Element.Poster({model:a,vent:this.vent});this.$el.prepend(b.render().el),this.tracks.push(b),b.align()},addToList:function(){this.playList.add(this.collection.at(0))},next:function(){var a=this.model.get("position");this.collection.shift(),this.model.set("position",a+=1)},upNext:function(){var a=this.tracks[this.model.get("position")];if(a&&a.listen(),this.collection.at(2)){this.renderTrack(this.collection.at(2))}}}),$(document).ready(function(){console.log("Document Ready"),FAB.init()}),FAB.init=function(){console.log("initializing FAB"),this.Vent=_.extend({},Backbone.Events),new this.Controller,new this.Router,Backbone.history.start(),console.log(this)};